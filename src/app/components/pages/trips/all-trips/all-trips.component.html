
<div class="row">
    <div class="col-md-6">
        <p>Nota para la profesora que corrija este examen:</p>
        <p>Los cambios realizados dentro del código del proyecto se focalizan en el componente all-trips (ts y html), single-trip(ts y html)
            y price-tracker (ts y html), además de cambios en el app routing module, configuración de i18n y header(html).
        </p>
        <p>Para ir al tracking price APP:  - hacer click en el botón de abajo" {{'trips.go_to_tracking_app' | translate}}", - dentro del nav de Explorer - escribir en la barra "price-tracker". Los trips que se añadan, quedarán registrados en el LocalStorage dentro de un array como valor, siendo la clave: "trackingTripsList".</p>
        <p>Para añadir un trip al seguimiento del Tracking Price App, hacer click en el botón amarillo "{{'trips.buttons.add-tracking' | translate}}" y para eliminarlo en el botón rojo{{'trips.buttons.remove-tracking' | translate}}.</p>
        <p>Para editar un trip, es necesario crear un trip siendo un manager (user:manager@elplan.es ; password:1234567890), publicarlo y ahí ya se puede editar precio, para que le salga al
            explorer la variación, dentro del detalle del trip.
            <i class="fa-solid fa-arrow-down" style="color:green" ></i>
      <i class="fa-solid fa-arrow-up" style="color:red"></i>
        </p>
        <button type="button" class="btn btn-primary" *ngIf="activeRole == 'EXPLORER'" routerLink="/price-tracker">
            <i class="fa-solid fa-glasses"></i>
            {{'trips.go_to_tracking_app' | translate}}
        </button></div>
    <div class="col-md-3 offset-md-3" *ngIf="showAddTripButton">
        <button type="button" class="btn btn-success" routerLink="/trips/add"  id="add-trip">
            <i class="fa-solid fa-plus"></i>
            {{'trips.buttons.add' | translate}}
        </button>
    </div>
</div>

<div class="row">
    <br>
</div>

<form [formGroup]="searchTripForm" (ngSubmit)="search()" >

    <div class="row">


        <div class="col-md-2">
        
            <!--keyWord start-->
            <div class="form-group has-danger">
                
                <label for="keyWord" class="form-control-label">{{'trips.keyWord' | translate}}:</label>

                <input 
                id="keyWord"
                type="text"
                class="form-control" 
                formControlName="keyWord"
                [class.is-valid]="searchTripForm.get('keyWord')?.valid && 
                ( searchTripForm.get('keyWord')?.dirty || searchTripForm.get('keyWord')?.touched )"
                [class.is-invalid]="searchTripForm.get('keyWord')?.invalid && 
                ( searchTripForm.get('keyWord')?.dirty || searchTripForm.get('keyWord')?.touched )" 
                />

            </div>

            <div *ngIf="searchTripForm.get('keyWord')?.invalid && 
                searchTripForm.get('keyWord')?.errors && 
                ( searchTripForm.get('keyWord')?.dirty || searchTripForm.get('keyWord')?.touched )" 
            >

                <small class="text-danger" *ngIf="searchTripForm.get('keyWord')?.hasError('pattern')">
                    {{'trips.validations.keyword_pattern' | translate}}
                </small>

            </div>
            <!--keyWord end-->
        
        </div>

        <div class="col-md-2">
        
            <!--priceLowerBound start-->
            <div class="form-group has-danger">
                
                <label for="priceLowerBound" class="form-control-label">{{'trips.priceLowerBound' | translate}}:</label>

                <input 
                id="priceLowerBound"
                type="number"
                class="form-control" 
                formControlName="priceLowerBound"
                [class.is-valid]="searchTripForm.get('priceLowerBound')?.valid && 
                ( searchTripForm.get('priceLowerBound')?.dirty || searchTripForm.get('priceLowerBound')?.touched )"
                [class.is-invalid]="searchTripForm.get('priceLowerBound')?.invalid && 
                ( searchTripForm.get('priceLowerBound')?.dirty || searchTripForm.get('priceLowerBound')?.touched )" 
                />

            </div>

            <div *ngIf="
                (
                    searchTripForm.get('priceLowerBound')?.invalid && 
                    searchTripForm.get('priceLowerBound')?.errors && 
                    ( searchTripForm.get('priceLowerBound')?.dirty || searchTripForm.get('priceLowerBound')?.touched )
                )
                ||
                (searchTripForm.get('priceLowerBound')?.value != '' && searchTripForm.hasError('price_range'))
                " 
            >

                <small class="text-danger" *ngIf="searchTripForm.get('priceLowerBound')?.hasError('min')">
                    {{'trips.validations.minimum' | translate}} 0.
                </small>
                <small class="text-danger" *ngIf="searchTripForm.get('priceLowerBound')?.hasError('max')">
                    {{'trips.validations.maximum' | translate}} 999999.
                </small>
                <small class="text-danger" *ngIf="searchTripForm.hasError('price_range')">
                    {{'trips.validations.price_range_invalid' | translate}}
                </small>

            </div>
            <!--priceLowerBound end-->

        </div>

        <div class="col-md-2">
        
            <!--priceUpperBound start-->
            <div class="form-group has-danger">
                
                <label for="priceUpperBound" class="form-control-label">{{'trips.priceUpperBound' | translate}}:</label>
        
                <input 
                id="priceUpperBound"
                type="number"
                class="form-control" 
                formControlName="priceUpperBound"
                [class.is-valid]="searchTripForm.get('priceUpperBound')?.valid && 
                ( searchTripForm.get('priceUpperBound')?.dirty || searchTripForm.get('priceUpperBound')?.touched )"
                [class.is-invalid]="searchTripForm.get('priceUpperBound')?.invalid && 
                ( searchTripForm.get('priceUpperBound')?.dirty || searchTripForm.get('priceUpperBound')?.touched )" 
                />
        
            </div>
        
            <div *ngIf="
                (
                    searchTripForm.get('priceUpperBound')?.invalid && 
                    searchTripForm.get('priceUpperBound')?.errors && 
                    ( searchTripForm.get('priceUpperBound')?.dirty || searchTripForm.get('priceUpperBound')?.touched )
                )
                ||
                (searchTripForm.get('priceUpperBound')?.value != '' && searchTripForm.hasError('price_range'))
                " 
            >
        
                <small class="text-danger" *ngIf="searchTripForm.get('priceUpperBound')?.hasError('min')">
                    {{'trips.validations.minimum' | translate}} 0.
                </small>
                <small class="text-danger" *ngIf="searchTripForm.get('priceUpperBound')?.hasError('max')">
                    {{'trips.validations.maximum' | translate}} 999999.
                </small>
                <small class="text-danger" *ngIf="searchTripForm.hasError('price_range')">
                    {{'trips.validations.price_range_invalid' | translate}}
                </small>
        
            </div>
            <!--priceUpperBound end-->
        
        </div>

        <div class="col-md-2">
        
            <!--dateLowerBound start-->
            <div class="form-group has-danger">
                
                <label for="dateLowerBound" class="form-control-label">{{'trips.dateLowerBound' | translate}}:</label>
        
                <input 
                id="dateLowerBound"
                type="date"
                class="form-control" 
                formControlName="dateLowerBound"
                [class.is-valid]="searchTripForm.get('dateLowerBound')?.valid && 
                ( searchTripForm.get('dateLowerBound')?.dirty || searchTripForm.get('dateLowerBound')?.touched )"
                [class.is-invalid]="searchTripForm.get('dateLowerBound')?.invalid && 
                ( searchTripForm.get('dateLowerBound')?.dirty || searchTripForm.get('dateLowerBound')?.touched )" 
                />
        
            </div>
        
            <div *ngIf="
                (
                    searchTripForm.get('dateLowerBound')?.invalid && 
                    searchTripForm.get('dateLowerBound')?.errors && 
                    ( searchTripForm.get('dateLowerBound')?.dirty || searchTripForm.get('dateLowerBound')?.touched )
                )
                ||
                (searchTripForm.get('dateLowerBound')?.value != '' && searchTripForm.hasError('date_range'))
                " 
            >
        
                <small class="text-danger" *ngIf="searchTripForm.hasError('date_range')">
                    {{'trips.validations.date_range_invalid' | translate}}
                </small>
        
            </div>
            <!--dateLowerBound end-->
        
        </div>

        <div class="col-md-2">
        
            <!--dateUpperBound start-->
            <div class="form-group has-danger">
                
                <label for="dateUpperBound" class="form-control-label">{{'trips.dateUpperBound' | translate}}:</label>
        
                <input 
                id="dateUpperBound"
                type="date"
                class="form-control" 
                formControlName="dateUpperBound"
                [class.is-valid]="searchTripForm.get('dateUpperBound')?.valid && 
                ( searchTripForm.get('dateUpperBound')?.dirty || searchTripForm.get('dateUpperBound')?.touched )"
                [class.is-invalid]="searchTripForm.get('dateUpperBound')?.invalid && 
                ( searchTripForm.get('dateUpperBound')?.dirty || searchTripForm.get('dateUpperBound')?.touched )" 
                />
        
            </div>
        
            <div *ngIf="
                (
                    searchTripForm.get('dateUpperBound')?.invalid && 
                    searchTripForm.get('dateUpperBound')?.errors && 
                    ( searchTripForm.get('dateUpperBound')?.dirty || searchTripForm.get('dateUpperBound')?.touched )
                )
                ||
                (searchTripForm.get('dateUpperBound')?.value != '' && searchTripForm.hasError('date_range'))
                " 
            >
        
                <small class="text-danger" *ngIf="searchTripForm.hasError('date_range')">
                    {{'trips.validations.date_range_invalid' | translate}}
                </small>
        
            </div>
            <!--dateUpperBound end-->
        
        </div>

        <div class="col-md-2">
            <button 
                class="btn btn-outline-secondary" 
                type="submit" id="search-button"
                [disabled]="searchTripForm.invalid"
            >
                <i class="fa fa-search" aria-hidden="true"></i>
                {{'trips.search' | translate}}
            </button>

        </div>

    </div>
    
</form>

<div class="row">
    <br>
</div>

<div class="row">
    <div class="col-md-3 offset-md-9" *ngIf="showSaveFinderButton">

        <button type="button" class="btn btn-success" (click)="createFinder()" [ngClass]="{ 'disabled' : (create_finder_sucess_message && create_finder_sucess_message != '') }">
            <i class="fa-solid fa-save"></i>
            {{'finders.buttons.save' | translate}}
        </button>

        <div class="alert alert-success" *ngIf="create_finder_sucess_message && create_finder_sucess_message != ''">
            {{create_finder_sucess_message | translate}}
        </div>

    </div>
</div>

<div class="row ">

    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
            <li *ngFor="let page of pages" class="page-item" >
                <a href="javascript:void(null)" class="page-link" (click)="getTrips(page)" >{{page}}</a>
            </li>
        </ul>
    </nav>

</div>

<div class="row">

    <div class="col-md-4 col-xs-12" *ngFor="let trip of trips">
        <div class="card">
            <img *ngIf="trip.getPictures().length > 0" src="{{trip.getPictures()[0]['picture']}}" class="card-img-top" alt="...">
            <img *ngIf="trip.getPictures().length == 0" src="assets/images/trips/default-trip.jpg" class="card-img-top" alt="...">
            <div class="card-body">
                <h5 class="card-title">
                    Ticker: {{trip.getTicker()}} 
                    <br> 
                    <br> 
                    {{trip.getTitle()}}
                </h5>
                <p class="card-text">{{trip.getDescription() | slice:0:20}} ...</p>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item"><b>{{'trips.price' | translate}}</b>: {{trip.getPrice()}}</li>
                <li class="list-group-item"
                    [ngStyle]="getCurrentStyles(trip.getStartDate().toString(), currentDateTime.toISOString())">
                    <b>{{'trips.startDate' | translate}}</b>: {{trip.getStartDate() | date: 'dd/MM/yyyy'}}
                    <p *ngIf="getNowAndStartDateDiffInDays(trip) > 0 && getNowAndStartDateDiffInDays(trip) <= 7">
                        <b>{{'trips.messages.start-soon' | translate}}</b></p>
                </li>
                <li class="list-group-item"><b>{{'trips.endDate' | translate}}</b>: {{trip.getEndDate() | date: 'dd/MM/yyyy'}}</li>
                <li class="list-group-item"><b>{{'trips.starting' | translate}}</b>: {{countDownTimer(trip.getStartDate().toString())}}</li>

            </ul>
            <div class="card-body">
                <button type="button" class="btn btn-success" routerLink="/trips/{{trip.id}}" name="trip-details">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    {{'trips.buttons.more' | translate}}
                </button>
                <button type="button" class="btn btn-primary"
                    *ngIf="activeRole == 'EXPLORER' && trip.getStartDate().toString() > currentDateTime.toISOString() && !trip.isCanceled()"
                    routerLink="/trips/{{trip.id}}/applications/new">
                    <i class="fa-solid fa-envelope"></i>
                    {{'applications.apply-for' | translate}}
                </button>
                <button type="button" class="btn btn-primary" *ngIf="activeRole == 'MANAGER' && user!.id == trip.getManagerId()"
                    routerLink="/trips/{{trip.id}}/applications/">
                    <i class="fa-solid fa-envelope"></i>
                    {{'applications.title-plural' | translate}}
                </button>
                <button type="button" class="btn btn-success" *ngIf="activeRole == 'EXPLORER'" routerLink="/trips/{{trip.id}}/favourites-lists">
                    <i class="fa-solid fa-heart-circle-plus"></i>
                    {{'trips.buttons.add-favourite' | translate}}
                </button>
                <button type="button" class="btn btn-warning" *ngIf="activeRole == 'EXPLORER' && verifyTripIsTracked(trip) == false" (click)="addTriptoTracking(trip)">
                    <i class="fa-solid fa-glasses"></i>
                    {{'trips.buttons.add-tracking' | translate}}
                </button>
                <button type="button" class="btn btn-danger" *ngIf="activeRole == 'EXPLORER' && verifyTripIsTracked(trip) == true" (click)="removeTripFromTracking(trip)">
                    <i class="fa-solid fa-glasses"></i>
                    {{'trips.buttons.remove-tracking' | translate}}
                </button>
            </div>
        </div>
    </div>

</div>
