<p>Add new trip</p>

<form [formGroup]="tripForm" (ngSubmit)="onSubmit()" >

    <!--TITLE START-->
    <div class="form-group has-danger">

        <label for="title" class="form-control-label">Title:</label>

        <input 
        id="title"
        type="text"
        class="form-control" 
        placeholder="Indicate trip's title"
        formControlName="title"
        [class.is-valid]="tripForm.get('title')?.valid && 
        ( tripForm.get('title')?.dirty || tripForm.get('title')?.touched )"
        [class.is-invalid]="tripForm.get('title')?.invalid && 
        ( tripForm.get('title')?.dirty || tripForm.get('title')?.touched )" 
        />

    </div>

    <div *ngIf="tripForm.get('title')?.invalid && 
        tripForm.get('title')?.errors && 
        ( tripForm.get('title')?.dirty || tripForm.get('title')?.touched )" 
    >

        <small class="text-danger" *ngIf="tripForm.get('title')?.hasError('required')">
            This field is required.
        </small>

    </div>
    <!--TITLE END-->

    <!--DESCRIPTION START-->
    <div class="form-group has-danger">
        
        <label for="description" class="form-control-label">Description:</label>

        <input 
        id="description"
        type="text"
        class="form-control" 
        placeholder="Indicate trip's description"
        formControlName="description"
        [class.is-valid]="tripForm.get('description')?.valid && 
        ( tripForm.get('description')?.dirty || tripForm.get('description')?.touched )"
        [class.is-invalid]="tripForm.get('description')?.invalid && 
        ( tripForm.get('description')?.dirty || tripForm.get('description')?.touched )" 
        />

    </div>

    <div *ngIf="tripForm.get('description')?.invalid && 
        tripForm.get('description')?.errors && 
        ( tripForm.get('description')?.dirty || tripForm.get('description')?.touched )" 
    >

        <small class="text-danger" *ngIf="tripForm.get('description')?.hasError('required')">
            This field is required.
        </small>

    </div>
    <!--DESCRIPTION END-->

    <!--PRICE START-->
    <div class="form-group has-danger">
        
        <label for="price" class="form-control-label">price:</label>
    
        <input 
        id="price"
        type="number"
        class="form-control" 
        placeholder="Indicate trip's price"
        formControlName="price"
        [class.is-valid]="tripForm.get('price')?.valid && 
        ( tripForm.get('price')?.dirty || tripForm.get('price')?.touched )"
        [class.is-invalid]="tripForm.get('price')?.invalid && 
        ( tripForm.get('price')?.dirty || tripForm.get('price')?.touched )" 
        />
    
    </div>
    
    <div *ngIf="tripForm.get('price')?.invalid && 
        tripForm.get('price')?.errors && 
        ( tripForm.get('price')?.dirty || tripForm.get('price')?.touched )" 
    >

        <small class="text-danger" *ngIf="tripForm.get('price')?.hasError('required')">
            This field is required.
        </small>
        <small class="text-danger" *ngIf="tripForm.get('price')?.hasError('min')">
            The minimum accepted value is 1.
        </small>
        <small class="text-danger" *ngIf="tripForm.get('price')?.hasError('max')">
            The maximum accepted value is 999999.
        </small>

    </div>
    <!--PRICE END-->

    <!--REQUIREMENTS START-->
    <div class="form-group has-danger">

        <label for="requirements" class="form-control-label">Requirements:</label>
    
        <button type="button" class="btn btn-success" (click)="onAddRequirement()">
            <i class="fa-solid fa-plus"></i>
            Add
        </button>
        
        <div class="col-md-10 offset-md-2 ">
    
            <div formArrayName="requirements">
                <div *ngFor="let row of tripForm.controls.requirements.controls; let i=index">
                    <div [formGroupName]="i">

                        <label >Requirement {{i + 1}}</label>

                        <div class="form-group">
    
                            <label for="requirement[{{i}}]" class="form-control-label" >Requirement</label>
    
                            <input
                            id="requirement[{{i}}]"
                            type="text"
                            class="form-control" 
                            placeholder="Indicate trip's requirements"
                            formControlName="requirement"
                            [class.is-valid]="row.get('requirement')?.valid && 
                            ( row.get('requirement')?.dirty || row.get('requirement')?.touched )"
                            [class.is-invalid]="row.get('requirement')?.invalid && 
                            ( row.get('requirement')?.dirty || row.get('requirement')?.touched )" 
                            />
                            
                            <div *ngIf="row.get('requirement')?.invalid && 
                                row.get('requirement')?.errors && 
                                ( row.get('requirement')?.dirty || row.get('requirement')?.touched )" 
                            >

                                <small class="text-danger" *ngIf="row.get('requirement')?.hasError('required')">
                                    This field is required.
                                </small>

                            </div>
    
                        </div>
                        <button class="btn btn-danger" (click)="onRemoveRequirement(i)">
                            <i class="fa-solid fa-trash"></i>
                            Delete
                        </button>
                    </div>
                </div>
            </div>

        </div>
    
    </div>
    <!--REQUIREMENTS END-->
    
    <!--START DATE START-->
    <div class="form-group has-danger">
        
        <label for="startDate" class="form-control-label">startDate:</label>
    
        <input 
        id="startDate"
        type="date"
        class="form-control" 
        placeholder="Indicate trip's startDate"
        formControlName="startDate"
        [class.is-valid]="tripForm.get('startDate')?.valid && 
        ( tripForm.get('startDate')?.dirty || tripForm.get('startDate')?.touched )"
        [class.is-invalid]="tripForm.get('startDate')?.invalid && 
        ( tripForm.get('startDate')?.dirty || tripForm.get('startDate')?.touched )" 
        />
    
    </div>
    
    <div *ngIf="tripForm.get('startDate')?.invalid && 
        tripForm.get('startDate')?.errors && 
        ( tripForm.get('startDate')?.dirty || tripForm.get('startDate')?.touched )"
    >

        <small class="text-danger" *ngIf="tripForm.get('startDate')?.hasError('required')">
            This field is required.
        </small>

    </div>
    <!--START DATE END-->

    <!--END DATE START-->
    <div class="form-group has-danger">
        
        <label for="endDate" class="form-control-label">endDate:</label>
    
        <input 
        id="endDate"
        type="date"
        class="form-control" 
        placeholder="Indicate trip's endDate"
        formControlName="endDate"
        [class.is-valid]="tripForm.get('endDate')?.valid && 
        ( tripForm.get('endDate')?.dirty || tripForm.get('endDate')?.touched )"
        [class.is-invalid]="tripForm.get('endDate')?.invalid && 
        ( tripForm.get('endDate')?.dirty || tripForm.get('endDate')?.touched )" 
        />
    
    </div>
    
    <div *ngIf="tripForm.get('endDate')?.invalid && 
        tripForm.get('endDate')?.errors && 
        ( tripForm.get('endDate')?.dirty || tripForm.get('endDate')?.touched )"
    >

        <small class="text-danger" *ngIf="tripForm.get('endDate')?.hasError('required')">
            This field is required.
        </small>

    </div>
    <!--END DATE END-->

    <!--PUBLICATION DATE START-->
    <div class="form-group has-danger">
        
        <label for="publicationDate" class="form-control-label">publicationDate:</label>
    
        <input 
        id="publicationDate"
        type="date"
        class="form-control" 
        placeholder="Indicate trip's publicationDate"
        formControlName="publicationDate"
        [class.is-valid]="tripForm.get('publicationDate')?.valid && 
        ( tripForm.get('publicationDate')?.dirty || tripForm.get('publicationDate')?.touched )"
        [class.is-invalid]="tripForm.get('publicationDate')?.invalid && 
        ( tripForm.get('publicationDate')?.dirty || tripForm.get('publicationDate')?.touched )" 
        />
    
    </div>
    
    <div *ngIf="tripForm.get('publicationDate')?.invalid && 
        tripForm.get('publicationDate')?.errors && 
        ( tripForm.get('publicationDate')?.dirty || tripForm.get('publicationDate')?.touched )"
    >

        <small class="text-danger" *ngIf="tripForm.get('publicationDate')?.hasError('required')">
            This field is required.
        </small>

    </div>
    <!--PUBLICATION DATE END-->

    <!--PICTURES START
    <div class="form-group has-danger">
        
        <label for="pictures" class="form-control-label">pictures:</label>
    
        <input 
        id="pictures"
        type="text"
        class="form-control" 
        placeholder="Indicate trip's pictures"
        formControlName="pictures"
        [class.is-valid]="tripForm.get('pictures')?.valid && ( tripForm.get('pictures')?.dirty || tripForm.get('pictures')?.touched )"
        [class.is-invalid]="tripForm.get('pictures')?.invalid && ( tripForm.get('pictures')?.dirty || tripForm.get('pictures')?.touched )" 
        />
    
    </div>
    
    <div *ngIf="tripForm.get('pictures')?.invalid && 
        tripForm.get('pictures')?.errors && 
        ( tripForm.get('pictures')?.dirty || tripForm.get('pictures')?.touched )"
    >

        <small class="text-danger" *ngIf="tripForm.get('pictures')?.hasError('required')">
            This field is required.
        </small>

    </div>-->
    <!--PICTURES END-->

    <!--PICTURES START-->
    <div class="form-group has-danger">

        <label for="pictures" class="form-control-label">Pictures:</label>
    
        <button type="button" class="btn btn-success" (click)="onAddPicture()">
            <i class="fa-solid fa-plus"></i>
            Add
        </button>
        
        <div class="col-md-10 offset-md-2 ">
    
            <div formArrayName="pictures">
                <div *ngFor="let row of tripForm.controls.pictures.controls; let i=index">
                    <div [formGroupName]="i">

                        <label >Picture {{i + 1}}</label>

                        <div class="form-group">
    
                            <label for="picture[{{i}}]" class="form-control-label" >Picture</label>
    
                            <input
                            id="picture[{{i}}]"
                            type="file"
                            accept="image/png, image/jpeg"
                            class="form-control" 
                            placeholder="Indicate trip's pictures"
                            formControlName="picture"
                            [class.is-valid]="row.get('picture')?.valid && 
                            ( row.get('picture')?.dirty || row.get('picture')?.touched )"
                            [class.is-invalid]="row.get('picture')?.invalid && 
                            ( row.get('picture')?.dirty || row.get('picture')?.touched )" 
                            />
                            
                            <div *ngIf="row.get('picture')?.invalid && 
                                row.get('picture')?.errors && 
                                ( row.get('picture')?.dirty || row.get('picture')?.touched )" 
                            >

                                <small class="text-danger" *ngIf="row.get('picture')?.hasError('required')">
                                    This field is required.
                                </small>

                            </div>
    
                        </div>
                        <button class="btn btn-danger" (click)="onRemovePicture(i)">
                            <i class="fa-solid fa-trash"></i>
                            Delete
                        </button>
                    </div>
                </div>
            </div>

        </div>
    
    </div>
    <!--PICTURES END-->

    <hr>

    <!--STAGES START-->
    <div class="form-group has-danger">

        <label for="stages" class="form-control-label">Stages:</label>
    
        <button type="button" class="btn btn-success" (click)="onAddStage()">
            <i class="fa-solid fa-plus"></i>
            Add
        </button>
        
        <div class="col-md-10 offset-md-2 ">
    
            <div formArrayName="stages">
                <div *ngFor="let row of tripForm.controls.stages.controls; let i=index">
                    <div [formGroupName]="i">

                        <label >Stage {{i + 1}}</label>

                        <div class="form-group">
    
                            <label for="title[{{i}}]" class="form-control-label">Title</label>
    
                            <input
                            id="title[{{i}}]"
                            type="text"
                            class="form-control" 
                            placeholder="Indicate stage's title"
                            formControlName="title"
                            [class.is-valid]="row.get('title')?.valid && 
                            ( row.get('title')?.dirty || row.get('title')?.touched )"
                            [class.is-invalid]="row.get('title')?.invalid && 
                            ( row.get('title')?.dirty || row.get('title')?.touched )" 
                            />
                            
                            <div *ngIf="row.get('title')?.invalid && 
                                row.get('title')?.errors && 
                                ( row.get('title')?.dirty || row.get('title')?.touched )" 
                            >
                            
                                <small class="text-danger" *ngIf="row.get('title')?.hasError('required')">
                                    This field is required.
                                </small>

                            </div>
    
                        </div>

                        <div class="form-group">
    
                            <label for="description[{{i}}]" class="form-control-label">Description</label>
    
                            <input
                            id="description[{{i}}]"
                            type="text"
                            class="form-control" 
                            placeholder="Indicate stage's description"
                            formControlName="description"
                            [class.is-valid]="row.get('description')?.valid && 
                            ( row.get('description')?.dirty || row.get('description')?.touched )"
                            [class.is-invalid]="row.get('description')?.invalid && 
                            ( row.get('description')?.dirty || row.get('description')?.touched )" 
                            />
                            
                            <div *ngIf="row.get('description')?.invalid && 
                                row.get('description')?.errors && 
                                ( row.get('description')?.dirty || row.get('description')?.touched )" 
                            >

                                <small class="text-danger" *ngIf="row.get('description')?.hasError('required')">
                                    This field is required.
                                </small>

                            </div>
    
                        </div>

                        <div class="form-group">
    
                            <label for="price[{{i}}]" class="form-control-label">Price</label>
    
                            <input
                            id="price[{{i}}]"
                            type="number"
                            class="form-control" 
                            placeholder="Indicate stage's price"
                            formControlName="price"
                            [class.is-valid]="row.get('price')?.valid && 
                            ( row.get('price')?.dirty || row.get('price')?.touched )"
                            [class.is-invalid]="row.get('price')?.invalid && 
                            ( row.get('price')?.dirty || row.get('price')?.touched )" 
                            />
                            
                            <div *ngIf="row.get('price')?.invalid && 
                                row.get('price')?.errors && 
                                ( row.get('price')?.dirty || row.get('price')?.touched )" 
                            >

                                <small class="text-danger" *ngIf="row.get('price')?.hasError('required')">
                                    This field is required.
                                </small>

                            </div>
    
                        </div>

                        <button class="btn btn-danger" (click)="onRemoveStage(i)">
                            <i class="fa-solid fa-trash"></i>
                            Delete
                        </button>
                    </div>
                </div>
            </div>
    
        </div>
    
    </div>
    <!--STAGES END-->

    <!--MANAGER ID START-->
    <div class="form-group has-danger " [hidden]="true" >
    
        <label for="managerId" class="form-control-label">managerId:</label>
    
        <input 
        id="managerId"
        type="text"
        class="form-control" 
        placeholder="Indicate trip's managerId"
        formControlName="managerId"
        [class.is-valid]="tripForm.get('managerId')?.valid && 
        ( tripForm.get('managerId')?.dirty || tripForm.get('managerId')?.touched )"
        [class.is-invalid]="tripForm.get('managerId')?.invalid && 
        ( tripForm.get('managerId')?.dirty || tripForm.get('managerId')?.touched )" 
        />
    
    </div>
    
    <div *ngIf="tripForm.get('managerId')?.invalid && 
        tripForm.get('managerId')?.errors && 
        ( tripForm.get('managerId')?.dirty || tripForm.get('managerId')?.touched )"
    >

        <small class="text-danger" *ngIf="tripForm.get('managerId')?.hasError('required')">
            This field is required.
        </small>

    </div>
    <!--MANAGER ID END-->

    <button type="submit" class="btn btn-primary" 
        [disabled]="tripForm.invalid
        || tripForm.controls.requirements.controls.length < 1
        || tripForm.controls.pictures.controls.length < 1
        || tripForm.controls.stages.controls.length < 1
        ">
        Add
    </button>

    <div class="alert alert-success" *ngIf="success_message">
    {{success_message}}
    </div>

    <div class="alert alert-danger" *ngIf="error_message">
    {{error_message}}
    </div>

</form>

<p>Form Status: {{ tripForm.status }}</p>